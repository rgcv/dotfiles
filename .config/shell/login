#!/bin/sh
## XDG Base Directory spec
# shellcheck disable=SC2174
[ -d "$XDG_RUNTIME_DIR" ] || mkdir -pm 0700 "$XDG_RUNTIME_DIR"

## umask
umask 0077

## graphic session
if [ -z "$DISPLAY" ]; then
  TTY=$(tty || echo "${XDG_VTNR--1}")
  TTY=${TTY#/dev/tty}
  case $TTY in
    1)
      if command -v sway >/dev/null; then
        export MOZ_ENABLE_WAYLAND=1
        export XDG_CURRENT_DESKTOP=sway
        export XDG_SESSION_TYPE=wayland
        export _JAVA_AWT_WM_NONREPARENTING=1
        if command -v gnome-keyring-daemon >/dev/null; then
          eval "$(gnome-keyring-daemon --start --components=pkcs11,secrets,ssh)"
          export SSH_AUTH_SOCK
        fi
        exec sway >/dev/null 2>&1
      fi
      ;;
    2)
      if command -v gnome-shell >/dev/null; then
        export MOZ_ENABLE_WAYLAND=1
        export XDG_CURRENT_DESKTOP=gnome
        export XDG_SESSION_TYPE=wayland
        exec gnome-shell --wayland
      fi
      ;;
    3) command -v startx >/dev/null && exec startx "$XINITRC" -- ":$TTY" ;;
  esac; unset TTY
fi
